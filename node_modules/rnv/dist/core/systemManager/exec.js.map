{"version":3,"sources":["../../../src/core/systemManager/exec.js"],"names":["require","exec","execSync","_execute","c","command","opts","defaultOpts","stdio","localDir","path","resolve","preferLocal","all","maxErrorLength","program","mono","interactive","silent","shell","mergedOpts","cleanCommand","interval","intervalTimer","timer","privateMask","cleanRawCmd","rawCommand","args","Array","isArray","join","logMessage","privateParams","ignoreErrors","spinner","text","start","green","setInterval","child","execa","MAX_OUTPUT_LENGTH","printLastLine","buffer","Buffer","from","toString","trim","lastLine","split","pop","substring","length","info","stdout","pipe","process","on","then","res","off","succeed","clearInterval","catch","err","fail","errMessage","parseErrorMessage","message","stderr","stack","Promise","reject","execCLI","cli","p","buildConfig","sdks","white","paths","workspace","config","executeAsync","_c","_cmd","_opts","cmd","Config","getConfig","includes","platform","replace","result","executeTelnet","port","output","nc2","NClient","addr","runtime","localhost","parseInt","connect","send","data","resp","close","e","gradleFailIndex","indexOf","nextFailIndex","toSearch","arr","errFound","filter","v","search","map","str","extractedError","isUsingWindows","fileNotExists","commandName","callback","constants","F_OK","fileNotExistsSync","localExecutable","X_OK","localExecutableSync","commandExistsUnix","cleanedCommandName","isFile","error","commandExistsWindows","test","commandExistsUnixSync","commandExistsWindowsSync","cleanInput","_s","s","isPathName","dirname","basename","commandExists","commandExistsSync","openCommand"],"mappings":";;;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+B;;AAE2BA,OAAO,CAAC,eAAD,C,CAA1BC,I,UAAAA,I,CAAMC,Q,UAAAA,Q;;;;;;;;;;;;;;;;;;;;AAoBd,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,CAAD,CAAIC,OAAJ,CAA2B,wGAAdC,CAAAA,IAAc,2DAAP,EAAO;AACxC,GAAMC,CAAAA,WAAW,CAAG;AAChBC,KAAK,CAAE,MADS;AAEhBC,QAAQ,CAAEC,cAAKC,OAAL,CAAa,qBAAb,CAFM;AAGhBC,WAAW,CAAE,IAHG;AAIhBC,GAAG,CAAE,IAJW;AAKhBC,cAAc,aAAEV,CAAC,CAACW,OAAJ,eAAE,WAAWD,cALX;AAMhBE,IAAI,cAAEZ,CAAC,CAACW,OAAJ,eAAE,YAAWC,IAND,CAApB;;;AASA,GAAIV,IAAI,CAACW,WAAT,CAAsB;AAClBV,WAAW,CAACW,MAAZ,CAAqB,IAArB;AACAX,WAAW,CAACC,KAAZ,CAAoB,SAApB;AACAD,WAAW,CAACY,KAAZ,CAAoB,IAApB;AACH;;AAED,GAAMC,CAAAA,UAAU,gCAAQb,WAAR,EAAwBD,IAAxB,CAAhB;;AAEA,GAAIe,CAAAA,YAAY,CAAGhB,OAAnB;AACA,GAAIiB,CAAAA,QAAJ;AACA,GAAMC,CAAAA,aAAa,CAAG,KAAtB;AACA,GAAIC,CAAAA,KAAK,CAAGD,aAAZ;AACA,GAAME,CAAAA,WAAW,CAAG,SAApB;AACA,GAAMC,CAAAA,WAAW,CAAG,mBAAApB,IAAI,CAACqB,UAAL,gCAAiBC,IAAjB,GAAyB,EAA7C;AACA,GAAIC,KAAK,CAACC,OAAN,CAAczB,OAAd,CAAJ,CAA4BgB,YAAY,CAAGhB,OAAO,CAAC0B,IAAR,CAAa,GAAb,CAAf;;AAE5BV,YAAY,EAAIK,WAAW,CAACK,IAAZ,CAAiB,GAAjB,CAAhB;AACA,GAAIC,CAAAA,UAAU,CAAGX,YAAjB,CA3BwC;AA4BhCY,aA5BgC,CA4Bdb,UA5Bc,CA4BhCa,aA5BgC;AA6BxC,GAAIA,aAAa,EAAIJ,KAAK,CAACC,OAAN,CAAcG,aAAd,CAArB,CAAmD;AAC/CD,UAAU,CAAG;AACT3B,OADS;AAET4B,aAFS;AAGTR,WAHS,CAAb;;AAKH;;AAED,kCAAsBO,UAAtB,EArCwC;AAsChCd,MAtCgC,CAsCeE,UAtCf,CAsChCF,MAtCgC,CAsCxBF,IAtCwB,CAsCeI,UAtCf,CAsCxBJ,IAtCwB,CAsClBF,cAtCkB,CAsCeM,UAtCf,CAsClBN,cAtCkB,CAsCFoB,YAtCE,CAsCed,UAtCf,CAsCFc,YAtCE;AAuCxC,GAAMC,CAAAA,OAAO,CAAG,CAACjB,MAAD,EAAW,CAACF,IAAZ,EAAoB,iBAAI,CAAEoB,IAAI,eAAgBJ,UAAtB,CAAJ,EAA0CK,KAA1C,EAApC;AACA,GAAI/B,IAAI,CAACW,WAAT,CAAsB;AAClB,mBAAU,oBAAQqB,KAAR,CAAc,GAAd,CAAV,gBAA2CN,UAA3C;AACH;;AAED,GAAIhB,IAAJ,CAAU;AACNM,QAAQ,CAAGiB,WAAW,CAAC,UAAM;AACzB,iCAAqBP,UAArB,OAAqCR,KAAK,CAAG,IAA7C;AACAA,KAAK,EAAID,aAAT;AACH,CAHqB,CAGnBA,aAHmB,CAAtB;AAIH;AACD,GAAIiB,CAAAA,KAAJ;AACA,GAAIlC,IAAI,CAACqB,UAAT,CAAqB;AACTC,IADS,CACAtB,IAAI,CAACqB,UADL,CACTC,IADS;AAEjBY,KAAK,CAAG,mBAAMnC,OAAN,CAAeuB,IAAf,CAAqBR,UAArB,CAAR;AACH,CAHD,IAGO;AACHoB,KAAK,CAAGC,eAAMpC,OAAN,CAAcgB,YAAd,CAA4BD,UAA5B,CAAR;AACH;;AAED,GAAMsB,CAAAA,iBAAiB,CAAG,GAA1B;;AAEA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,MAAD,CAAY;AAC9B,GAAMR,CAAAA,IAAI,CAAGS,MAAM,CAACC,IAAP,CAAYF,MAAZ;AACRG,QADQ;AAERC,IAFQ,EAAb;AAGA,GAAMC,CAAAA,QAAQ,CAAGb,IAAI,CAACc,KAAL,CAAW,IAAX,EAAiBC,GAAjB,EAAjB;AACAhB,OAAO,CAACC,IAAR,CAAe;AACXa,QAAQ,CAACG,SAAT,CAAmB,CAAnB,CAAsBV,iBAAtB,CADW;AAEXT,aAFW;AAGXR,WAHW,CAAf;;AAKA,GAAIwB,QAAQ,CAACI,MAAT,GAAoBX,iBAAxB,CAA2CP,OAAO,CAACC,IAAR,EAAgB,OAAhB;AAC9C,CAXD;;AAaA,GAAI,cAAAhC,CAAC,CAACW,OAAF,2BAAWuC,IAAX,YAAmBd,KAAnB,8BAAmB,OAAOe,MAA1B,eAAmB,cAAeC,IAAlC,CAAJ,CAA4C;AACxChB,KAAK,CAACe,MAAN,CAAaC,IAAb,CAAkBC,OAAO,CAACF,MAA1B;AACH,CAFD,IAEO,IAAIpB,OAAO,YAAIK,KAAJ,+BAAI,QAAOe,MAAX,eAAI,eAAeG,EAAnB,CAAX,CAAkC;AACrClB,KAAK,CAACe,MAAN,CAAaG,EAAb,CAAgB,MAAhB,CAAwBf,aAAxB;AACH;;AAED,MAAOH,CAAAA,KAAK;AACPmB,IADE,CACG,SAACC,GAAD,CAAS;AACX,YAAIpB,KAAJ,+BAAI,QAAOe,MAAX,eAAI,eAAeM,GAAnB,CAAwB;AACpB1B,OAAO,EAAIK,KAAK,CAACe,MAAN,CAAaM,GAAb,CAAiB,MAAjB,CAAyBlB,aAAzB,CAAX;AACH;;AAED,CAACzB,MAAD,EAAW,CAACF,IAAZ,EAAoBmB,OAAO,CAAC2B,OAAR,eAA8B9B,UAA9B,CAApB;AACA;AACI,oCAAyB4B,GAAG,CAAC/C,GAA7B,CAAkCoB,aAAlC,CAAiDR,WAAjD,CADJ;;AAGAH,QAAQ,EAAIyC,aAAa,CAACzC,QAAD,CAAzB;;AAEA,MAAOsC,CAAAA,GAAG,CAACL,MAAX;AACH,CAbE;AAcFS,KAdE,CAcI,SAACC,GAAD,CAAS;AACZ,YAAIzB,KAAJ,+BAAI,QAAOe,MAAX,eAAI,eAAeM,GAAnB,CAAwB;AACpB1B,OAAO,EAAIK,KAAK,CAACe,MAAN,CAAaM,GAAb,CAAiB,MAAjB,CAAyBlB,aAAzB,CAAX;AACH;;AAED,GAAI,CAACzB,MAAD,EAAW,CAACF,IAAZ,EAAoB,CAACkB,YAAzB,CAAuC,CAAEC,OAAO,CAAC+B,IAAR,YAAwBlC,UAAxB,EAAwC;AACjF;AACI,oCAAyBiC,GAAG,CAACpD,GAA7B,CAAkCoB,aAAlC,CAAiDR,WAAjD,CADJ;;AAGAH,QAAQ,EAAIyC,aAAa,CAACzC,QAAD,CAAzB;;AAEA,GAAIY,YAAY,EAAI,CAAChB,MAAjB,EAA2B,CAACF,IAAhC,CAAsC;AAClCmB,OAAO,CAAC2B,OAAR,eAA8B9B,UAA9B;AACA,MAAO,KAAP;AACH;;AAED,GAAImC,CAAAA,UAAU,CAAGC,iBAAiB,CAACH,GAAG,CAACpD,GAAL,CAAUC,cAAV,CAAlC;;AAEA,GAAI,CAACqD,UAAL,CAAiB;AACbA,UAAU,CAAG,EAAb;AACH,CAFD,IAEO;AACHA,UAAU,EAAI,MAAd;AACH;;AAED,GAAIF,GAAG,CAACI,OAAR,CAAiB;AACbF,UAAU,EAAOF,GAAG,CAACI,OAAX,OAAV;AACH;;AAED,GAAIJ,GAAG,CAACK,MAAR,CAAgB;AACZH,UAAU,EAAOF,GAAG,CAACK,MAAX,OAAV;AACH;;AAED,GAAIL,GAAG,CAACM,KAAR,CAAe;AACXJ,UAAU,EAAOF,GAAG,CAACM,KAAX,OAAV;AACH;;AAEDJ,UAAU,CAAG;AACTA,UADS;AAETlC,aAFS;AAGTR,WAHS,CAAb;;;AAMA,MAAO+C,CAAAA,OAAO,CAACC,MAAR;AACazC,UADb,gCACsDmC,UADtD,CAAP;;AAGH,CA3DE,CAAP;AA4DH,CA3ID;;;;;;;;;;;;;AAwJA,GAAMO,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACtE,CAAD,CAAIuE,GAAJ,CAAStE,OAAT,CAAgC,IAAdC,CAAAA,IAAc,2DAAP,EAAO;AAC5C,GAAI,CAACF,CAAC,CAACW,OAAP,CAAgB;AACZ,MAAOyD,CAAAA,OAAO,CAACC,MAAR;AACH,2DADG,CAAP;;AAGH;AACD,GAAMG,CAAAA,CAAC,CAAGxE,CAAC,CAACuE,GAAF,CAAMA,GAAN,CAAV;AACA,GAAI,CAAC,4BAAaC,CAAb,CAAL,CAAsB;AAClB,uCAA2BD,GAA3B,OAAoCtE,OAApC,CAA+C,iBAA/C,CAAkED,CAAC,CAACuE,GAApE,CAAyE,iBAAzE,iBAA4FvE,CAAC,CAACyE,WAA9F,eAA4F,eAAeC,IAA3G;AACA,MAAON,CAAAA,OAAO,CAACC,MAAR;AACqB,oBAAQM,KAAR;AACpBH,CADoB,CADrB;AAG8B,oBAAQG,KAAR;AAC7B3E,CAAC,CAAC4E,KAAF,CAAQC,SAAR,CAAkBC,MADW,CAH9B;AAKe,oBAAQH,KAAR,CAAc,MAAd,CALf,sBAAP;;AAOH;;AAED,MAAO5E,CAAAA,QAAQ,CAACC,CAAD,CAAOwE,CAAP,KAAYvE,OAAZ,gCAA4BC,IAA5B,MAAkCa,KAAK,CAAE,IAAzC,GAAf;AACH,CAnBD,C;;;;;;;;;;;AA8BA,GAAMgE,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAOC,EAAP,CAAWC,IAAX,CAAiBC,KAAjB;;AAEblF,CAFa,CAETgF,EAFS;AAGbG,GAHa,CAGPF,IAHO;AAIb/E,IAJa,CAINgF,KAJM;AAKjB,GAAI,MAAOlF,CAAAA,CAAP,GAAa,QAAjB,CAA2B;AACvBE,IAAI,CAAGiF,GAAP;AACAA,GAAG,CAAGnF,CAAN;AACAA,CAAC,CAAGoF,gBAAOC,SAAP,EAAJ;AACH;AACDnF,IAAI,CAAGA,IAAI,EAAI,EAAf;AACA,GAAIiF,GAAG,CAACG,QAAJ,CAAa,KAAb,GAAuBjC,OAAO,CAACkC,QAAR,GAAqB,OAAhD,CAAyD,CAAEJ,GAAG,CAACK,OAAJ,CAAY,KAAZ,CAAmB,SAAnB,EAAgC,CAX1E;;;;;;;;;;;;;;;;;;;;;AAgCIzF,QAAQ,CAACC,CAAD,CAAImF,GAAJ,CAASjF,IAAT,CAhCZ,SAgCXuF,MAhCW;;AAkCVA,MAlCU,wEAArB,C;;;;;;;;;;;;AA8CA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAC1F,CAAD,CAAI2F,IAAJ,CAAU1F,OAAV,QAAsB,IAAImE,CAAAA,OAAJ,CAAY,SAAC7D,OAAD,CAAa;AACjE,oCAAwBoF,IAAxB,KAAgC1F,OAAhC;AACA,GAAI;AACA,GAAI2F,CAAAA,MAAM,CAAG,EAAb;AACA,GAAMC,CAAAA,GAAG,CAAG,GAAIC,gBAAJ,EAAZ;AACAD,GAAG,CAACE,IAAJ,CAAS/F,CAAC,CAACgG,OAAF,CAAUC,SAAnB;AACKN,IADL,CACUO,QAAQ,CAACP,IAAD,CAAO,EAAP,CADlB;AAEKQ,OAFL;AAGKC,IAHL,CAGanG,OAHb;AAIA4F,GAAG,CAACvC,EAAJ,CAAO,MAAP,CAAe,SAAC+C,IAAD,CAAU;AACrB,GAAMC,CAAAA,IAAI,CAAG7D,MAAM,CAACC,IAAP,CAAY2D,IAAZ,EAAkB1D,QAAlB,EAAb;AACAiD,MAAM,EAAIU,IAAV;AACA,GAAIV,MAAM,CAACN,QAAP,CAAgB,IAAhB,CAAJ,CAA2BO,GAAG,CAACU,KAAJ;AAC9B,CAJD;AAKAV,GAAG,CAACvC,EAAJ,CAAO,OAAP,CAAgB,iBAAM/C,CAAAA,OAAO,CAACqF,MAAD,CAAb,EAAhB;AACH,CAAC,MAAOY,CAAP,CAAU;AACR,qBAASA,CAAT;AACAjG,OAAO;AACV;AACJ,CAnB2C,CAAtB,EAAtB,C;;;;;;;;;;;;;;;;;;;;;;AAyCO,GAAMyD,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAAChC,IAAD,CAAgC,IAAzBtB,CAAAA,cAAyB,2DAAR,GAAQ;AAC7D,GAAI,CAACsB,IAAL,CAAW,MAAO,EAAP;;AAEX,GAAMyE,CAAAA,eAAe,CAAGzE,IAAI,CAAC0E,OAAL,CAAa,0CAAb,CAAxB;AACA,GAAID,eAAe,GAAK,CAAC,CAAzB,CAA4B;AACxB,MAAOzE,CAAAA,IAAI,CAACgB,SAAL,CAAeyD,eAAf,CAAP;AACH;;AAED,GAAME,CAAAA,aAAa,CAAG3E,IAAI,CAAC0E,OAAL,CAAa,wBAAb,CAAtB;AACA,GAAIC,aAAa,GAAK,CAAC,CAAvB,CAA0B;AACtB,MAAO3E,CAAAA,IAAI,CAACgB,SAAL,CAAe2D,aAAf,CAAP;AACH;AACD,GAAMC,CAAAA,QAAQ,CAAG,+BAAjB;AACA,GAAIC,CAAAA,GAAG,CAAG7E,IAAI,CAACc,KAAL,CAAW,IAAX,CAAV;;AAEA,GAAIgE,CAAAA,QAAQ,CAAG,CAAf;AACAD,GAAG,CAAGA,GAAG,CAACE,MAAJ,CAAW,SAACC,CAAD,CAAO;AACpB,GAAIA,CAAC,GAAK,EAAV,CAAc,MAAO,MAAP;;AAEd;AACIA,CAAC,CAAC1B,QAAF,CAAW,SAAX;AACG0B,CAAC,CAAC1B,QAAF,CAAW,uCAAX,CADH;AAEG0B,CAAC,CAAC1B,QAAF,CAAW,OAAX,CAFH;AAGG0B,CAAC,CAAC1B,QAAF,CAAW,QAAX,CAHH;AAIG0B,CAAC,CAAC1B,QAAF,CAAW,WAAX,CAJH;AAKG0B,CAAC,CAAC1B,QAAF,CAAW,6CAAX,CALH;AAMG0B,CAAC,CAAC1B,QAAF,CAAW,IAAX,CANH;AAOG0B,CAAC,CAAC1B,QAAF,CAAW,gFAAX,CARP;AASE;AACE,MAAO,MAAP;AACH;;AAED;AACI0B,CAAC,CAAC1B,QAAF,CAAW,SAAX;AACG0B,CAAC,CAAC1B,QAAF,CAAW,QAAX,CADH;AAEG0B,CAAC,CAAC1B,QAAF,CAAW,aAAX,CAFH;AAGG0B,CAAC,CAAC1B,QAAF,CAAW,QAAX,CAHH;AAIG0B,CAAC,CAAC1B,QAAF,CAAW,8BAAX,CAJH;AAKG0B,CAAC,CAAC1B,QAAF,CAAW,UAAX,CALH;AAMG0B,CAAC,CAAC1B,QAAF,CAAW,aAAX,CANH;AAOG0B,CAAC,CAAC1B,QAAF,CAAW,yBAAX,CARP;AASE;AACE,MAAO,MAAP;AACH;;;;;AAKD,GAAI0B,CAAC,CAACC,MAAF,CAASL,QAAT,IAAuB,CAAC,CAA5B,CAA+B;AAC3BE,QAAQ,CAAG,CAAX;AACA,MAAO,KAAP;AACH;AACD,GAAIA,QAAQ,CAAG,CAAf,CAAkB;AACdA,QAAQ,EAAI,CAAZ;AACA,MAAO,KAAP;AACH;;AAED,MAAO,MAAP;AACH,CA1CK,CAAN;;AA4CAD,GAAG,CAAGA,GAAG,CAACK,GAAJ,CAAQ,SAACC,GAAD,CAAS;AACnB,GAAMH,CAAAA,CAAC,CAAGG,GAAG,CAAC3B,OAAJ,CAAY,SAAZ,CAAuB,GAAvB,CAAV;AACA,GAAI4B,CAAAA,cAAc,CAAGJ,CAAC,CAAChE,SAAF,CAAY,CAAZ,CAAetC,cAAf,CAArB;AACA,GAAI0G,cAAc,CAACnE,MAAf,GAA0BvC,cAA9B,CAA8C0G,cAAc,EAAI,KAAlB;AAC9C,MAAOA,CAAAA,cAAP;AACH,CALK,CAAN;;AAOA,MAAOP,CAAAA,GAAG,CAAClF,IAAJ,CAAS,IAAT,CAAP;AACH,CApEM,C;;AAsEP,GAAM0F,CAAAA,cAAc,CAAGhE,OAAO,CAACkC,QAAR,GAAqB,OAA5C;;AAEA,GAAM+B,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,WAAD,CAAcC,QAAd,CAA2B;AAC7C,eAAOD,WAAP,CAAoBE,cAAUC,IAA9B,CAAoC,SAAC7D,GAAD,CAAS;AACzC2D,QAAQ,CAAC,CAAC3D,GAAF,CAAR;AACH,CAFD;AAGH,CAJD;;AAMA,GAAM8D,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACJ,WAAD,CAAiB;AACvC,GAAI;AACA,mBAAWA,WAAX,CAAwBE,cAAUC,IAAlC;AACA,MAAO,MAAP;AACH,CAAC,MAAOlB,CAAP,CAAU;AACR,MAAO,KAAP;AACH;AACJ,CAPD;;AASA,GAAMoB,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACL,WAAD,CAAcC,QAAd,CAA2B;AAC/C,eAAOD,WAAP,CAAoBE,cAAUC,IAAV,CAAiBD,cAAUI,IAA/C,CAAqD,SAAChE,GAAD,CAAS;AAC1D2D,QAAQ,CAAC,IAAD,CAAO,CAAC3D,GAAR,CAAR;AACH,CAFD;AAGH,CAJD;;AAMA,GAAMiE,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACP,WAAD,CAAiB;AACzC,GAAI;AACA,mBAAWA,WAAX,CAAwBE,cAAUC,IAAV,CAAiBD,cAAUI,IAAnD;AACA,MAAO,KAAP;AACH,CAAC,MAAOrB,CAAP,CAAU;AACR,MAAO,MAAP;AACH;AACJ,CAPD;;AASA,GAAMuB,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACR,WAAD,CAAcS,kBAAd,CAAkCR,QAAlC,CAA+C;AACrEF,aAAa,CAACC,WAAD,CAAc,SAACU,MAAD,CAAY;AACnC,GAAI,CAACA,MAAL,CAAa;AACTpI,IAAI;AACA,cAAcmI,kBAAd;AACwBA,kBADxB,eADA;AAGA,SAACE,KAAD,CAAQ/E,MAAR,CAAmB;AACfqE,QAAQ,CAAC,IAAD,CAAO,CAAC,CAACrE,MAAT,CAAR;AACH,CALD,CAAJ;;AAOA;AACH;;AAEDyE,eAAe,CAACL,WAAD,CAAcC,QAAd,CAAf;AACH,CAbY,CAAb;AAcH,CAfD;;AAiBA,GAAMW,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACZ,WAAD,CAAcS,kBAAd,CAAkCR,QAAlC,CAA+C;AACxE,GAAI,qBAAqBY,IAArB,CAA0Bb,WAA1B,CAAJ,CAA4C;AACxCC,QAAQ,CAAC,IAAD,CAAO,KAAP,CAAR;AACA;AACH;AACD3H,IAAI,UAAUmI,kBAAV,CAAgC,SAACE,KAAD,CAAW;AAC3C,GAAIA,KAAK,GAAK,IAAd,CAAoB;AAChBV,QAAQ,CAAC,IAAD,CAAO,KAAP,CAAR;AACH,CAFD,IAEO;AACHA,QAAQ,CAAC,IAAD,CAAO,IAAP,CAAR;AACH;AACJ,CANG,CAAJ;AAOH,CAZD;;AAcA,GAAMa,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CAACd,WAAD,CAAcS,kBAAd,CAAqC;AAC/D,GAAIL,iBAAiB,CAACJ,WAAD,CAArB,CAAoC;AAChC,GAAI;AACA,GAAMpE,CAAAA,MAAM,CAAGrD,QAAQ;AACnB,cAAckI,kBAAd;AACwBA,kBADxB,eADmB,CAAvB;;AAIA,MAAO,CAAC,CAAC7E,MAAT;AACH,CAAC,MAAO+E,KAAP,CAAc;AACZ,MAAO,MAAP;AACH;AACJ;AACD,MAAOJ,CAAAA,mBAAmB,CAACP,WAAD,CAA1B;AACH,CAbD;;AAeA,GAAMe,CAAAA,wBAAwB,CAAG,QAA3BA,CAAAA,wBAA2B,CAACf,WAAD,CAAcS,kBAAd,CAAqC;AAClE,GAAI,qBAAqBI,IAArB,CAA0Bb,WAA1B,CAAJ,CAA4C;AACxC,MAAO,MAAP;AACH;AACD,GAAI;AACA,GAAMpE,CAAAA,MAAM,CAAGrD,QAAQ,UAAUkI,kBAAV,CAAgC,CAAE5H,KAAK,CAAE,EAAT,CAAhC,CAAvB;AACA,MAAO,CAAC,CAAC+C,MAAT;AACH,CAAC,MAAO+E,KAAP,CAAc;AACZ,MAAO,MAAP;AACH;AACJ,CAVD;;AAYA,GAAIK,CAAAA,UAAU,CAAG,oBAACC,EAAD,CAAQ;AACrB,GAAIC,CAAAA,CAAC,CAAGD,EAAR;AACA,GAAI,oBAAoBJ,IAApB,CAAyBK,CAAzB,CAAJ,CAAiC;AAC7BA,CAAC,KAAOA,CAAC,CAACjD,OAAF,CAAU,IAAV,CAAgB,OAAhB,CAAP,IAAD;AACAiD,CAAC,CAAGA,CAAC;AACAjD,OADD,CACS,WADT,CACsB,EADtB;AAECA,OAFD,CAES,QAFT,CAEmB,KAFnB,CAAJ;AAGH;AACD,MAAOiD,CAAAA,CAAP;AACH,CATD;;AAWA,GAAIpB,cAAJ,CAAoB;AAChBkB,UAAU,CAAG,oBAACE,CAAD,CAAO;AAChB,GAAMC,CAAAA,UAAU,CAAG,OAAON,IAAP,CAAYK,CAAZ,CAAnB;AACA,GAAIC,UAAJ,CAAgB;AACZ,GAAMC,CAAAA,OAAO,MAAOrI,cAAKqI,OAAL,CAAaF,CAAb,CAAP,KAAb;AACA,GAAMG,CAAAA,QAAQ,MAAOtI,cAAKsI,QAAL,CAAcH,CAAd,CAAP,KAAd;AACA,MAAUE,CAAAA,OAAV,KAAqBC,QAArB;AACH;AACD,WAAWH,CAAX;AACH,CARD;AASH;;AAED,GAAMI,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACtB,WAAD,CAAcC,QAAd,CAA2B;AAC7C,GAAMQ,CAAAA,kBAAkB,CAAGO,UAAU,CAAChB,WAAD,CAArC;AACA,GAAI,CAACC,QAAD,EAAa,MAAOpD,CAAAA,OAAP,GAAmB,WAApC,CAAiD;AAC7C,MAAO,IAAIA,CAAAA,OAAJ,CAAY,SAAC7D,OAAD,CAAU8D,MAAV,CAAqB;AACpCwE,aAAa,CAACtB,WAAD,CAAc,SAACW,KAAD,CAAQtC,MAAR,CAAmB;AAC1C,GAAIA,MAAJ,CAAY;AACRrF,OAAO,CAACgH,WAAD,CAAP;AACH,CAFD,IAEO;AACHlD,MAAM,CAAC6D,KAAD,CAAN;AACH;AACJ,CANY,CAAb;AAOH,CARM,CAAP;AASH;AACD,GAAIb,cAAJ,CAAoB;AAChBc,oBAAoB,CAACZ,WAAD,CAAcS,kBAAd,CAAkCR,QAAlC,CAApB;AACH,CAFD,IAEO;AACHO,iBAAiB,CAACR,WAAD,CAAcS,kBAAd,CAAkCR,QAAlC,CAAjB;AACH;AACJ,CAlBD,C;;AAoBA,GAAMsB,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACvB,WAAD,CAAiB;AACvC,GAAMS,CAAAA,kBAAkB,CAAGO,UAAU,CAAChB,WAAD,CAArC;AACA,GAAIF,cAAJ,CAAoB;AAChB,MAAOiB,CAAAA,wBAAwB,CAACf,WAAD,CAAcS,kBAAd,CAA/B;AACH;AACD,MAAOK,CAAAA,qBAAqB,CAACd,WAAD,CAAcS,kBAAd,CAA5B;AACH,CAND,C;;;;AAUA,GAAMe,CAAAA,WAAW,CAAG1F,OAAO,CAACkC,QAAR,GAAqB,QAArB;AACd,MADc;AAEdlC,OAAO,CAACkC,QAAR,GAAqB,OAArB;AACI,OADJ;AAEI,UAJV,C;;;;;;;;;;;AAee;AACXR,YAAY,CAAZA,YADW;AAEXT,OAAO,CAAPA,OAFW;AAGXyE,WAAW,CAAXA,WAHW;AAIXrD,aAAa,CAAbA,aAJW,C","sourcesContent":["/* eslint-disable no-control-regex */\n/* eslint-disable no-bitwise */\n/* eslint-disable no-await-in-loop */\n\nimport path from 'path';\nimport { access, accessSync, constants } from 'fs';\nimport execa from 'execa';\nimport ora from 'ora';\nimport NClient from 'netcat/client';\nimport Config from '../configManager/config';\n\nimport { chalk, logDebug, logRaw, logError } from './logger';\nimport { fsExistsSync } from './fileutils';\nimport { replaceOverridesInString } from '../utils';\n\nconst { exec, execSync } = require('child_process');\n\n/**\n *\n * Also accepts the Node's child_process exec/spawn options\n *\n * @typedef {Object} Opts\n * @property {Object} privateParams - private params that will be masked in the logs\n * @property {Boolean} silent - don't print anything\n * @property {Boolean} ignoreErrors - will print the loader but it will finish with a\n * checkmark regardless of the outcome. Also, it never throws a catch.\n * @property {Boolean} interactive - when you want to execute a command that requires user input\n *\n * Execute commands\n *\n * @param {String} command - command to be executed\n * @param {Opts} [opts={}] - the options for the command\n * @returns {Promise}\n *\n */\nconst _execute = (c, command, opts = {}) => {\n    const defaultOpts = {\n        stdio: 'pipe',\n        localDir: path.resolve('./node_modules/.bin'),\n        preferLocal: true,\n        all: true,\n        maxErrorLength: c.program?.maxErrorLength,\n        mono: c.program?.mono,\n    };\n\n    if (opts.interactive) {\n        defaultOpts.silent = true;\n        defaultOpts.stdio = 'inherit';\n        defaultOpts.shell = true;\n    }\n\n    const mergedOpts = { ...defaultOpts, ...opts };\n\n    let cleanCommand = command;\n    let interval;\n    const intervalTimer = 30000; // 30s\n    let timer = intervalTimer;\n    const privateMask = '*******';\n    const cleanRawCmd = opts.rawCommand?.args || [];\n    if (Array.isArray(command)) cleanCommand = command.join(' ');\n\n    cleanCommand += cleanRawCmd.join(' ');\n    let logMessage = cleanCommand;\n    const { privateParams } = mergedOpts;\n    if (privateParams && Array.isArray(privateParams)) {\n        logMessage = replaceOverridesInString(\n            command,\n            privateParams,\n            privateMask\n        );\n    }\n\n    logDebug(`_execute: ${logMessage}`);\n    const { silent, mono, maxErrorLength, ignoreErrors } = mergedOpts;\n    const spinner = !silent && !mono && ora({ text: `Executing: ${logMessage}` }).start();\n    if (opts.interactive) {\n        logRaw(`${chalk().green('✔')} Executing: ${logMessage}\\n`);\n    }\n\n    if (mono) {\n        interval = setInterval(() => {\n            logRaw(`Executing: ${logMessage} - ${timer / 1000}s`);\n            timer += intervalTimer;\n        }, intervalTimer);\n    }\n    let child;\n    if (opts.rawCommand) {\n        const { args } = opts.rawCommand;\n        child = execa(command, args, mergedOpts);\n    } else {\n        child = execa.command(cleanCommand, mergedOpts);\n    }\n\n    const MAX_OUTPUT_LENGTH = 200;\n\n    const printLastLine = (buffer) => {\n        const text = Buffer.from(buffer)\n            .toString()\n            .trim();\n        const lastLine = text.split('\\n').pop();\n        spinner.text = replaceOverridesInString(\n            lastLine.substring(0, MAX_OUTPUT_LENGTH),\n            privateParams,\n            privateMask\n        );\n        if (lastLine.length === MAX_OUTPUT_LENGTH) spinner.text += '...\\n';\n    };\n\n    if (c.program?.info && child?.stdout?.pipe) {\n        child.stdout.pipe(process.stdout);\n    } else if (spinner && child?.stdout?.on) {\n        child.stdout.on('data', printLastLine);\n    }\n\n    return child\n        .then((res) => {\n            if (child?.stdout?.off) {\n                spinner && child.stdout.off('data', printLastLine);\n            }\n\n            !silent && !mono && spinner.succeed(`Executing: ${logMessage}`);\n            logDebug(\n                replaceOverridesInString(res.all, privateParams, privateMask)\n            );\n            interval && clearInterval(interval);\n            // logDebug(res);\n            return res.stdout;\n        })\n        .catch((err) => {\n            if (child?.stdout?.off) {\n                spinner && child.stdout.off('data', printLastLine);\n            }\n\n            if (!silent && !mono && !ignoreErrors) { spinner.fail(`FAILED: ${logMessage}`); } // parseErrorMessage will return false if nothing is found, default to previous implementation\n            logDebug(\n                replaceOverridesInString(err.all, privateParams, privateMask)\n            );\n            interval && clearInterval(interval);\n            // logDebug(err);\n            if (ignoreErrors && !silent && !mono) {\n                spinner.succeed(`Executing: ${logMessage}`);\n                return true;\n            }\n\n            let errMessage = parseErrorMessage(err.all, maxErrorLength);\n\n            if (!errMessage) {\n                errMessage = '';\n            } else {\n                errMessage += '\\n\\n';\n            }\n\n            if (err.message) {\n                errMessage += `${err.message}\\n\\n`;\n            }\n\n            if (err.stderr) {\n                errMessage += `${err.stderr}\\n\\n`;\n            }\n\n            if (err.stack) {\n                errMessage += `${err.stack}\\n\\n`;\n            }\n\n            errMessage = replaceOverridesInString(\n                errMessage,\n                privateParams,\n                privateMask\n            );\n\n            return Promise.reject(\n                `COMMAND: \\n\\n${logMessage} \\n\\nFAILED with ERROR: \\n\\n${errMessage}`\n            ); // parseErrorMessage will return false if nothing is found, default to previous implementation\n        });\n};\n\n/**\n *\n * Execute CLI command\n *\n * @param {Object} c - the trusty old c object\n * @param {String} cli - the cli to be executed\n * @param {String} command - the command to be executed\n * @param {Opts} [opts={}] - the options for the command\n * @returns {Promise}\n *\n */\nconst execCLI = (c, cli, command, opts = {}) => {\n    if (!c.program) {\n        return Promise.reject(\n            'You need to pass c object as first parameter to execCLI()'\n        );\n    }\n    const p = c.cli[cli];\n    if (!fsExistsSync(p)) {\n        logDebug(`execCLI error: ${cli} | ${command}`, '\\nCLI Config:\\n', c.cli, '\\nSDK Config:\\n', c.buildConfig?.sdks);\n        return Promise.reject(\n            `Location of your cli ${chalk().white(\n                p\n            )} does not exists. check your ${chalk().white(\n                c.paths.workspace.config\n            )} file if your ${chalk().white('sdks')} paths are correct`\n        );\n    }\n\n    return _execute(c, `${p} ${command}`, { ...opts, shell: true });\n};\n\n/**\n *\n * Execute a plain command\n *\n * @param {String} command - the command to be executed\n * @param {Opts} [opts={}] - the options for the command\n * @returns {Promise}\n *\n */\nconst executeAsync = async (_c, _cmd, _opts) => {\n    // swap values if c is not specified and get it from it's rightful place, config :)\n    let c = _c;\n    let cmd = _cmd;\n    let opts = _opts;\n    if (typeof c === 'string') {\n        opts = cmd;\n        cmd = c;\n        c = Config.getConfig();\n    }\n    opts = opts || {};\n    if (cmd.includes('npm') && process.platform === 'win32') { cmd.replace('npm', 'npm.cmd'); }\n    // let cmdArr;\n    // if (typeof cmd === 'string') {\n    //     cmdArr = cmd.split('&&');\n    // } else {\n    //     cmdArr = cmd;\n    // }\n\n    // let result;\n    // if (cmdArr.length) {\n    //     for (let i = 0; i < cmdArr.length; i++) {\n    //         // if (cmdArr[i].startsWith('cd ')) {\n    //         //     // TODO: flaky. will need to improve\n    //         //     const newCwd = path.join(CURRENT_DIR, cmdArr[i].replace('cd ', ''));\n    //         //     opts.cwd = newCwd;\n    //         // } else {\n    //         //     await _execute(c, cmdArr[i], opts);\n    //         // }\n    //         result = await _execute(c, cmdArr[i], opts);\n    //     }\n    // }\n    const result = await _execute(c, cmd, opts);\n\n    return result;\n};\n\n/**\n *\n * Connect to a local telnet server and execute a command\n *\n * @param {Number|String} port - where do you want me to connect to?\n * @param {String} command - the command to be executed once I'm connected\n * @returns {Promise}\n *\n */\nconst executeTelnet = (c, port, command) => new Promise((resolve) => {\n    logDebug(`execTelnet: ${port} ${command}`);\n    try {\n        let output = '';\n        const nc2 = new NClient();\n        nc2.addr(c.runtime.localhost)\n            .port(parseInt(port, 10))\n            .connect()\n            .send(`${command}\\n`);\n        nc2.on('data', (data) => {\n            const resp = Buffer.from(data).toString();\n            output += resp;\n            if (output.includes('OK')) nc2.close();\n        });\n        nc2.on('close', () => resolve(output));\n    } catch (e) {\n        logError(e);\n        resolve();\n    }\n});\n\n// Legacy error parser\n// export const parseErrorMessage = (text, maxErrorLength = 800) => {\n//     const errors = [];\n//     const toSearch = /(exception|error|fatal|\\[!])/i;\n//\n//     const extractError = (t) => {\n//         const errorFound = t ? t.search(toSearch) : -1;\n//         if (errorFound === -1) return errors.length ? errors.join(' ') : false; // return the errors or false if we found nothing at all\n//         const usefulString = t.substring(errorFound); // dump first part of the string that doesn't contain what we look for\n//         let extractedError = usefulString.substring(0, maxErrorLength);\n//         if (extractedError.length === maxErrorLength) extractedError += '...'; // add elipsis if string is bigger than maxErrorLength\n//         errors.push(extractedError); // save the error\n//         const newString = usefulString.substring(100); // dump everything we processed and continue\n//         return extractError(newString);\n//     };\n//\n//     return extractError(text);\n// };\n\n\nexport const parseErrorMessage = (text, maxErrorLength = 800) => {\n    if (!text) return '';\n    // Gradle specific\n    const gradleFailIndex = text.indexOf('FAILURE: Build failed with an exception.');\n    if (gradleFailIndex !== -1) {\n        return text.substring(gradleFailIndex);\n    }\n    // NextJS Specific\n    const nextFailIndex = text.indexOf('> Build error occurred');\n    if (nextFailIndex !== -1) {\n        return text.substring(nextFailIndex);\n    }\n    const toSearch = /(exception|error|fatal|\\[!])/i;\n    let arr = text.split('\\n');\n\n    let errFound = 0;\n    arr = arr.filter((v) => {\n        if (v === '') return false;\n        // Cleaner iOS reporting\n        if (\n            v.includes('-Werror')\n            || v.includes('following modules are linked manually')\n            || v.includes('warn ')\n            || v.includes('note: ')\n            || v.includes('warning: ')\n            || v.includes('Could not find the following native modules')\n            || v.includes('⚠️')\n            || v.includes('/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain')\n        ) {\n            return false;\n        }\n        // Cleaner Android reporting\n        if (\n            v.includes('[DEBUG]')\n            || v.includes('[INFO]')\n            || v.includes('[LIFECYCLE]')\n            || v.includes('[WARN]')\n            || v.includes(':+HeapDumpOnOutOfMemoryError')\n            || v.includes('.errors.')\n            || v.includes('-exception-')\n            || v.includes('error_prone_annotations')\n        ) {\n            return false;\n        }\n        // Special Helper for iOS\n        // if (v.endsWith('^')) {\n        //     arr[i - 1] = chalk().red(arr[i - 1]);\n        // }\n        if (v.search(toSearch) !== -1) {\n            errFound = 5;\n            return true;\n        }\n        if (errFound > 0) {\n            errFound -= 1;\n            return true;\n        }\n\n        return false;\n    });\n\n    arr = arr.map((str) => {\n        const v = str.replace(/\\s{2,}/g, ' ');\n        let extractedError = v.substring(0, maxErrorLength);\n        if (extractedError.length === maxErrorLength) extractedError += '...';\n        return extractedError;\n    });\n\n    return arr.join('\\n');\n};\n\nconst isUsingWindows = process.platform === 'win32';\n\nconst fileNotExists = (commandName, callback) => {\n    access(commandName, constants.F_OK, (err) => {\n        callback(!err);\n    });\n};\n\nconst fileNotExistsSync = (commandName) => {\n    try {\n        accessSync(commandName, constants.F_OK);\n        return false;\n    } catch (e) {\n        return true;\n    }\n};\n\nconst localExecutable = (commandName, callback) => {\n    access(commandName, constants.F_OK | constants.X_OK, (err) => {\n        callback(null, !err);\n    });\n};\n\nconst localExecutableSync = (commandName) => {\n    try {\n        accessSync(commandName, constants.F_OK | constants.X_OK);\n        return true;\n    } catch (e) {\n        return false;\n    }\n};\n\nconst commandExistsUnix = (commandName, cleanedCommandName, callback) => {\n    fileNotExists(commandName, (isFile) => {\n        if (!isFile) {\n            exec(\n                `command -v ${cleanedCommandName} 2>/dev/null`\n                    + ` && { echo >&1 ${cleanedCommandName}; exit 0; }`,\n                (error, stdout) => {\n                    callback(null, !!stdout);\n                }\n            );\n            return;\n        }\n\n        localExecutable(commandName, callback);\n    });\n};\n\nconst commandExistsWindows = (commandName, cleanedCommandName, callback) => {\n    if (/[\\x00-\\x1f<>:\"|?*]/.test(commandName)) {\n        callback(null, false);\n        return;\n    }\n    exec(`where ${cleanedCommandName}`, (error) => {\n        if (error !== null) {\n            callback(null, false);\n        } else {\n            callback(null, true);\n        }\n    });\n};\n\nconst commandExistsUnixSync = (commandName, cleanedCommandName) => {\n    if (fileNotExistsSync(commandName)) {\n        try {\n            const stdout = execSync(\n                `command -v ${cleanedCommandName} 2>/dev/null`\n                    + ` && { echo >&1 ${cleanedCommandName}; exit 0; }`\n            );\n            return !!stdout;\n        } catch (error) {\n            return false;\n        }\n    }\n    return localExecutableSync(commandName);\n};\n\nconst commandExistsWindowsSync = (commandName, cleanedCommandName) => {\n    if (/[\\x00-\\x1f<>:\"|?*]/.test(commandName)) {\n        return false;\n    }\n    try {\n        const stdout = execSync(`where ${cleanedCommandName}`, { stdio: [] });\n        return !!stdout;\n    } catch (error) {\n        return false;\n    }\n};\n\nlet cleanInput = (_s) => {\n    let s = _s;\n    if (/[^A-Za-z0-9_/:=-]/.test(s)) {\n        s = `'${s.replace(/'/g, \"'\\\\''\")}'`;\n        s = s\n            .replace(/^(?:'')+/g, '') // unduplicate single-quote at the beginning\n            .replace(/\\\\'''/g, \"\\\\'\"); // remove non-escaped single-quote if there are enclosed between 2 escaped\n    }\n    return s;\n};\n\nif (isUsingWindows) {\n    cleanInput = (s) => {\n        const isPathName = /[\\\\]/.test(s);\n        if (isPathName) {\n            const dirname = `\"${path.dirname(s)}\"`;\n            const basename = `\"${path.basename(s)}\"`;\n            return `${dirname}:${basename}`;\n        }\n        return `\"${s}\"`;\n    };\n}\n\nconst commandExists = (commandName, callback) => {\n    const cleanedCommandName = cleanInput(commandName);\n    if (!callback && typeof Promise !== 'undefined') {\n        return new Promise((resolve, reject) => {\n            commandExists(commandName, (error, output) => {\n                if (output) {\n                    resolve(commandName);\n                } else {\n                    reject(error);\n                }\n            });\n        });\n    }\n    if (isUsingWindows) {\n        commandExistsWindows(commandName, cleanedCommandName, callback);\n    } else {\n        commandExistsUnix(commandName, cleanedCommandName, callback);\n    }\n};\n\nconst commandExistsSync = (commandName) => {\n    const cleanedCommandName = cleanInput(commandName);\n    if (isUsingWindows) {\n        return commandExistsWindowsSync(commandName, cleanedCommandName);\n    }\n    return commandExistsUnixSync(commandName, cleanedCommandName);\n};\n\n\n// eslint-disable-next-line no-nested-ternary\nconst openCommand = process.platform === 'darwin'\n    ? 'open'\n    : process.platform === 'win32'\n        ? 'start'\n        : 'xdg-open';\n\nexport {\n    executeAsync,\n    execCLI,\n    commandExists,\n    commandExistsSync,\n    openCommand,\n    executeTelnet\n};\n\nexport default {\n    executeAsync,\n    execCLI,\n    openCommand,\n    executeTelnet\n};\n"],"file":"exec.js"}