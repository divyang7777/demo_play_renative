{"version":3,"sources":["../../src/deployTools/webTools.js"],"names":["DEPLOY_TARGET_DOCKER","DEPLOY_TARGET_AWS","DEPLOY_TARGET_FTP","DEPLOY_TARGET_NOW","DEPLOY_TARGET_NONE","_runDeployment","c","platform","deployType","Promise","resolve","deployToDocker","setRNVPath","process","mainModule","filename","split","doDeploy","deployerPackage","reject","Error","_runExport","exportType","rnvPath","doExport","selectToolAndExecute","choices","configFunction","executeFunction","isDeploy","defaultChoice","argv","slice","type","t","targetConfig","buildConfig","platforms","deploy","name","default","message","chalk","white","selectedTarget","paths","appConfig","config","selectWebToolAndDeploy","configureDeploymentIfRequired","selectWebToolAndExport","configureExportIfRequired"],"mappings":"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","sourcesContent":["/* eslint-disable import/no-cycle */\nimport chalk from 'chalk';\nimport minimist from 'minimist';\n\nimport { deployToNow } from './now';\nimport { deployToFtp } from './ftp';\nimport { importPackageFromProject } from '../common';\nimport { logInfo } from '../systemTools/logger';\nimport {\n    configureDeploymentIfRequired,\n    configureExportIfRequired\n} from './configure';\nimport { inquirerPrompt } from '../systemTools/prompt';\n\nconst DEPLOY_TARGET_DOCKER = 'docker';\nconst DEPLOY_TARGET_AWS = 'aws';\nconst DEPLOY_TARGET_FTP = 'ftp';\nconst DEPLOY_TARGET_NOW = 'now';\nconst DEPLOY_TARGET_NONE = 'none';\n\nconst _runDeployment = async (c, platform, deployType) => {\n    switch (deployType) {\n        case DEPLOY_TARGET_FTP:\n            return deployToFtp(c, platform);\n        case DEPLOY_TARGET_NOW:\n            return deployToNow(c, platform);\n        case DEPLOY_TARGET_NONE:\n            return Promise.resolve();\n        case DEPLOY_TARGET_DOCKER: {\n            const deployToDocker = importPackageFromProject(\n                '@rnv/deploy-docker'\n            );\n            deployToDocker.setRNVPath(\n                process.mainModule.filename.split(\n                    '/bin/index.js'\n                )[0]\n            );\n            return deployToDocker.doDeploy();\n        }\n        case DEPLOY_TARGET_AWS: {\n            const deployerPackage = importPackageFromProject('@rnv/deploy-aws');\n            deployerPackage.setRNVPath(process.mainModule.filename.split('/bin/index.js')[0]);\n            return deployerPackage.doDeploy();\n        }\n        default:\n            return Promise.reject(\n                new Error(`Deploy Type not supported ${deployType}`)\n            );\n    }\n};\n\nconst _runExport = (c, platform, exportType) => {\n    switch (exportType) {\n        case DEPLOY_TARGET_DOCKER: {\n            const rnvPath = process.mainModule.filename.split(\n                '/bin/index.js'\n            )[0];\n            const deployToDocker = importPackageFromProject(\n                '@rnv/deploy-docker'\n            );\n            deployToDocker.setRNVPath(rnvPath);\n            return deployToDocker.doExport();\n        }\n        case DEPLOY_TARGET_NONE:\n            return Promise.resolve();\n        default:\n            return Promise.reject(\n                new Error(`Export Type not supported ${exportType}`)\n            );\n    }\n};\n\nconst selectToolAndExecute = async ({\n    c,\n    platform,\n    choices,\n    configFunction,\n    executeFunction,\n    isDeploy = true,\n    defaultChoice\n}) => {\n    const argv = minimist(c.process.argv.slice(2));\n    const type = argv.t;\n    const targetConfig = c.buildConfig.platforms[platform];\n\n    if (\n        type\n        || (targetConfig && targetConfig.deploy && targetConfig.deploy.type)\n    ) {\n        await configFunction(type || targetConfig.deploy.type);\n        return executeFunction(c, platform, type || targetConfig.deploy.type);\n    }\n    const { selectedTarget } = await inquirerPrompt({\n        name: 'selectedTarget',\n        type: 'list',\n        choices,\n        default: defaultChoice,\n        message: `Which type of ${\n            isDeploy ? 'deploy' : 'export'\n        } option would you like to use for ${chalk.white(c.platform)}?`\n    });\n\n    await configFunction(selectedTarget);\n\n    logInfo(\n        `Setting your appconfig for ${chalk.white(platform)} to include ${\n            isDeploy ? 'deploy' : 'export'\n        } type: ${chalk.white(selectedTarget)} at ${chalk.white(\n            c.paths.appConfig.config\n        )}`\n    );\n    return executeFunction(c, platform, selectedTarget);\n};\n\nconst selectWebToolAndDeploy = (c, platform) => selectToolAndExecute({\n    c,\n    platform,\n    choices: [DEPLOY_TARGET_DOCKER, DEPLOY_TARGET_AWS, DEPLOY_TARGET_FTP, DEPLOY_TARGET_NOW, DEPLOY_TARGET_NONE],\n    configFunction: configureDeploymentIfRequired,\n    executeFunction: _runDeployment\n});\n\nconst selectWebToolAndExport = (c, platform) => selectToolAndExecute({\n    c,\n    platform,\n    choices: [DEPLOY_TARGET_DOCKER, DEPLOY_TARGET_NONE],\n    configFunction: configureExportIfRequired,\n    executeFunction: _runExport,\n    isDeploy: false,\n    defaultChoice: DEPLOY_TARGET_NONE,\n});\n\nexport {\n    selectWebToolAndDeploy,\n    selectWebToolAndExport,\n    DEPLOY_TARGET_FTP,\n    DEPLOY_TARGET_NOW,\n    DEPLOY_TARGET_AWS,\n    DEPLOY_TARGET_NONE\n};\n"],"file":"webTools.js"}