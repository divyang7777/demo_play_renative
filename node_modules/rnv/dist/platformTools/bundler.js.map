{"version":3,"sources":["../../src/platformTools/bundler.js"],"names":["_isBundlerRunning","c","platform","axios","get","runtime","localhost","port","data","includes","isBundlerActive","poll","fn","timeout","interval","endTime","Number","Date","spinner","start","checkCondition","resolve","reject","result","succeed","setTimeout","fail","Promise","waitForBundler"],"mappings":";AACA;AACA;AACA;AACA;;AAEA,GAAMA,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAAOC,CAAP;AACtB,yCAA6BA,CAAC,CAACC,QAA/B,EADsB;;AAGKC,eAAMC,GAAN;AACTH,CAAC,CAACI,OAAF,CAAUC,SADD,KACcL,CAAC,CAACI,OAAF,CAAUE,IADxB,KACgC;AAC/CN,CAD+C;AAE/CA,CAAC,CAACC,QAF6C;AAG/C,WAH+C,CADhC,OAHL,wCAGVM,IAHU,kBAGVA,IAHU;;;AAUdA,IAAI,CAACC,QAAL,CAAc,QAAd,CAVc,yDAUkB,IAVlB;AAWX,KAXW;;AAaX,KAbW,4EAA1B;;;;AAiBO,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAOT,CAAP;AAC3B,uCAA2BA,CAAC,CAACC,QAA7B,YAAgDD,CAAC,CAACI,OAAF,CAAUC,SAA1D,KAAuEL,CAAC,CAACI,OAAF,CAAUE,IAAjF,EAD2B;;AAGjBJ,eAAMC,GAAN,WAAoBH,CAAC,CAACI,OAAF,CAAUC,SAA9B,KAA2CL,CAAC,CAACI,OAAF,CAAUE,IAArD,CAHiB;AAIhB,IAJgB;;AAMhB,KANgB,4EAAxB,C;;;;AAUP,GAAMI,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,CAACC,EAAD,CAA0C,IAArCC,CAAAA,OAAqC,2DAA3B,KAA2B,IAApBC,CAAAA,QAAoB,2DAAT,IAAS;AACnD,GAAMC,CAAAA,OAAO,CAAGC,MAAM,CAAC,GAAIC,CAAAA,IAAJ,EAAD,CAAN,CAAqBJ,OAArC;;AAEA,GAAMK,CAAAA,OAAO,CAAG,iBAAI,kCAAJ,EAAwCC,KAAxC,EAAhB;AACA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAAOC,OAAP,CAAgBC,MAAhB;;AAEMV,EAAE,EAFR,SAETW,MAFS;AAGf,GAAIA,MAAJ,CAAY;AACRL,OAAO,CAACM,OAAR;AACAH,OAAO;AACV,CAHD,IAGO,IAAIL,MAAM,CAAC,GAAIC,CAAAA,IAAJ,EAAD,CAAN,CAAqBF,OAAzB,CAAkC;AACrCU,UAAU,CAACL,cAAD,CAAiBN,QAAjB,CAA2BO,OAA3B,CAAoCC,MAApC,CAAV;AACH,CAFM,IAEA;AACHJ,OAAO,CAACQ,IAAR,CAAa,8CAAb;AACAJ,MAAM,CAAC,8CAAD,CAAN;AACH,CAXc;;AAafJ,OAAO,CAACQ,IAAR,CAAa,8CAAb;AACAJ,MAAM,cAAN,CAde,0EAAvB;;;;AAkBA,MAAO,IAAIK,CAAAA,OAAJ,CAAYP,cAAZ,CAAP;AACH,CAvBD;;AAyBO,GAAMQ,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAAM3B,CAAN,+JAAWU,IAAI,CAAC,iBAAMX,CAAAA,iBAAiB,CAACC,CAAD,CAAvB,EAAD,CAAf,wEAAvB,C","sourcesContent":["/* eslint-disable import/no-cycle */\nimport axios from 'axios';\nimport ora from 'ora';\nimport { getConfigProp } from '../common';\nimport { logTask } from '../systemTools/logger';\n\nconst _isBundlerRunning = async (c) => {\n    logTask(`_isBundlerRunning:${c.platform}`);\n    try {\n        const { data } = await axios.get(\n            `http://${c.runtime.localhost}:${c.runtime.port}/${getConfigProp(\n                c,\n                c.platform,\n                'entryFile'\n            )}.js`\n        );\n        if (data.includes('import')) return true;\n        return false;\n    } catch (e) {\n        return false;\n    }\n};\n\nexport const isBundlerActive = async (c) => {\n    logTask(`isBundlerActive:${c.platform}:http://${c.runtime.localhost}:${c.runtime.port}`);\n    try {\n        await axios.get(`http://${c.runtime.localhost}:${c.runtime.port}`);\n        return true;\n    } catch (e) {\n        return false;\n    }\n};\n\nconst poll = (fn, timeout = 10000, interval = 1000) => {\n    const endTime = Number(new Date()) + timeout;\n\n    const spinner = ora('Waiting for bundler to finish...').start();\n    const checkCondition = async (resolve, reject) => {\n        try {\n            const result = await fn();\n            if (result) {\n                spinner.succeed();\n                resolve();\n            } else if (Number(new Date()) < endTime) {\n                setTimeout(checkCondition, interval, resolve, reject);\n            } else {\n                spinner.fail(\"Can't connect to bundler. Try restarting it.\");\n                reject(\"Can't connect to bundler. Try restarting it.\");\n            }\n        } catch (e) {\n            spinner.fail(\"Can't connect to bundler. Try restarting it.\");\n            reject(e);\n        }\n    };\n\n    return new Promise(checkCondition);\n};\n\nexport const waitForBundler = async c => poll(() => _isBundlerRunning(c));\n"],"file":"bundler.js"}